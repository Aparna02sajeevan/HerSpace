{% extends 'base.html' %}
{% load static %}

{% block content %}

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .fade-in { animation: fadeIn 0.8s ease-out; }

    .glass-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.6);
        box-shadow: 0 20px 60px rgba(106, 90, 205, 0.15);
        transition: all 0.3s ease;
    }

    .glass-card:hover {
        box-shadow: 0 25px 70px rgba(106, 90, 205, 0.2);
    }

    .stat-card {
        animation: fadeIn 0.8s ease-out;
    }

    input, select {
        transition: all 0.3s ease;
    }

    input:focus, select:focus {
        background: rgba(106, 90, 205, 0.05) !important;
    }
</style>

<div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 py-12 px-4">
    <div class="max-w-6xl mx-auto">

        <!-- Header -->
        <div class="fade-in mb-12">
            <div class="flex items-center justify-between gap-4 mb-6">
                <h1 class="text-5xl font-bold text-gray-900" style="font-family: 'Playfair Display', serif;">
                    üí∞ Financial Planner
                </h1>
                <p class="text-lg text-gray-600">Track, plan and grow your money wisely</p>
            </div>
            <div class="w-24 h-1 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full"></div>
        </div>

        <!-- Month Filter -->
        <div class="fade-in glass-card rounded-2xl p-6 mb-8 shadow-lg">
            <form method="GET" class="flex gap-4 flex-wrap items-center">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Select Month</label>
                    <input type="month" name="month" value="{{ selected_month }}"
                        class="px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500/30 focus:border-green-500 bg-gray-50">
                </div>
                <button type="submit" class="mt-6 px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-semibold rounded-lg shadow-lg shadow-green-500/30 transition-all transform hover:scale-105 active:scale-95">
                    üîç Filter
                </button>
            </form>
        </div>

        <!-- Add Transaction Form -->
        <div class="fade-in glass-card rounded-2xl p-8 mb-12 shadow-lg">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">‚ûï Add Transaction</h2>
            
            <form method="POST" class="space-y-6">
                {% csrf_token %}

                {% if form.non_field_errors %}
                    <div class="p-4 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm">
                        {{ form.non_field_errors }}
                    </div>
                {% endif %}

                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Type</label>
                        <select name="entry_type" required class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500/30 bg-gray-50">
                            <option value="Income">üíπ Income</option>
                            <option value="Expense">üí∏ Expense</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Amount (‚Çπ)</label>
                        <input type="number" name="amount" placeholder="0.00" step="0.01" required
                            class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500/30 bg-gray-50">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Description</label>
                    <input type="text" name="description" placeholder="What's this transaction for?" required
                        class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500/30 bg-gray-50">
                </div>

                <button type="submit" class="w-full py-3 px-6 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-semibold rounded-lg shadow-lg shadow-green-500/30 transition-all transform hover:scale-105 active:scale-95">
                    ‚úÖ Add Entry
                </button>
            </form>
        </div>

        <!-- Summary Cards -->
        <div class="grid md:grid-cols-3 gap-6 mb-12">

            <div class="stat-card glass-card p-8 rounded-2xl shadow-lg">
                <div class="flex items-center justify-between mb-4">
                    <h4 class="text-gray-700 font-semibold">Total Income</h4>
                    <span class="text-2xl">üíπ</span>
                </div>
                <p class="text-4xl font-bold text-green-600">‚Çπ{{ total_income|default:"0" }}</p>
            </div>

            <div class="stat-card glass-card p-8 rounded-2xl shadow-lg" style="animation-delay: 0.1s;">
                <div class="flex items-center justify-between mb-4">
                    <h4 class="text-gray-700 font-semibold">Total Expense</h4>
                    <span class="text-2xl">üí∏</span>
                </div>
                <p class="text-4xl font-bold text-red-600">‚Çπ{{ total_expense|default:"0" }}</p>
            </div>

            <div class="stat-card glass-card p-8 rounded-2xl shadow-lg" style="animation-delay: 0.2s;">
                <div class="flex items-center justify-between mb-4">
                    <h4 class="text-gray-700 font-semibold">Balance</h4>
                    <span class="text-2xl">‚öñÔ∏è</span>
                </div>
                <p class="text-4xl font-bold {% if balance|add:0 < 0 %}text-red-600{% else %}text-blue-600{% endif %}">
                    ‚Çπ{{ balance|default:"0" }}
                </p>
            </div>

        </div>

        <!-- Spending Alert -->
        {% if spending_alert %}
        <div class="fade-in glass-card p-8 rounded-2xl mb-12 border-l-4 border-red-500 bg-red-50 shadow-lg">
            <h3 class="text-xl font-semibold text-red-700 mb-2">üö® Spending Alert</h3>
            <p class="text-red-600">Your expenses are higher than your income this month. Consider reviewing your spending patterns.</p>
        </div>
        {% endif %}

        <!-- Expense Chart -->
        {% if chart_labels %}
        <div class="fade-in glass-card p-8 rounded-2xl mb-12 shadow-lg">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">üìä Expense Breakdown</h2>
            <canvas id="expenseChart" class="max-h-96"></canvas>
        </div>
        {% endif %}

        <!-- Transactions Table -->
        <div class="fade-in glass-card p-8 rounded-2xl shadow-lg overflow-hidden">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">üí≥ Recent Transactions</h2>

            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="bg-gray-50 border-b-2 border-gray-200">
                            <th class="px-4 py-3 text-left font-semibold text-gray-700">Type</th>
                            <th class="px-4 py-3 text-left font-semibold text-gray-700">Description</th>
                            <th class="px-4 py-3 text-right font-semibold text-gray-700">Amount</th>
                            <th class="px-4 py-3 text-right font-semibold text-gray-700">Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for entry in entries %}
                        <tr class="border-b border-gray-100 hover:bg-purple-50/50 transition-colors">
                            <td class="px-4 py-3">
                                <span class="px-3 py-1 rounded-full text-xs font-semibold {% if entry.entry_type == 'Income' %}bg-green-100 text-green-700{% else %}bg-red-100 text-red-700{% endif %}">
                                    {{ entry.entry_type }}
                                </span>
                            </td>
                            <td class="px-4 py-3 text-gray-800">{{ entry.description }}</td>
                            <td class="px-4 py-3 text-right font-bold {% if entry.entry_type == 'Income' %}text-green-600{% else %}text-red-600{% endif %}">
                                {% if entry.entry_type == 'Income' %}+{% else %}-{% endif %}‚Çπ{{ entry.amount }}
                            </td>
                            <td class="px-4 py-3 text-right text-gray-500 text-xs">
                                {{ entry.created_at|date:"M d, Y H:i" }}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="4" class="text-center py-8 text-gray-500">
                                <p class="text-lg">üìä No transactions yet. Start tracking your finances!</p>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>

<!-- Chart Configuration -->
{{ chart_labels|json_script:"chart_labels" }}
{{ chart_data|json_script:"chart_data" }}

<script>
const labelsEl = document.getElementById('chart_labels');
const dataEl = document.getElementById('chart_data');

const labels = labelsEl ? JSON.parse(labelsEl.textContent) : [];
const data = dataEl ? JSON.parse(dataEl.textContent) : [];

const ctx = document.getElementById('expenseChart');

if (ctx && labels.length && data.length) {
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: labels,
            datasets: [{
                data: data,
                backgroundColor: [
                    '#ef4444',
                    '#3b82f6',
                    '#f59e0b',
                    '#10b981',
                    '#a855f7',
                    '#ec4899',
                    '#06b6d4'
                ],
                borderColor: '#fff',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#374151',
                        font: { size: 12, weight: 'bold' },
                        padding: 15
                    }
                }
            }
        }
    });
}
</script>

{% endblock %}